{"version":2,"kind":"Notebook","sha256":"d2e2015d5b3da19b3e04c9be6b992347d561aee44bbdd0eda08783361835af4c","slug":"notebooks.example-workflows.precip-freq","location":"/notebooks/example-workflows/precip-freq.ipynb","dependencies":[],"frontmatter":{"title":"Precipitation Frequency Analysis","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Ryan Abernathey","given":"Ryan","family":"Abernathey"},"name":"Ryan Abernathey","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Henri Drake","given":"Henri","family":"Drake"},"name":"Henri Drake","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Robert Ford","given":"Robert","family":"Ford"},"name":"Robert Ford","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Max Grover","given":"Max","family":"Grover"},"name":"Max Grover","id":"contributors-myst-generated-uid-3"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/cmip6-cookbook","copyright":"2024","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/cmip6-cookbook/blob/main/notebooks/example-workflows/precip-freq.ipynb","exports":[{"format":"ipynb","filename":"precip-freq.ipynb","url":"/cmip6-cookbook/build/precip-freq-8df8ae1fb0f27ca6c12b62562bbd4e5d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ckiVGAgPT0"}],"key":"MF0cT6KNpd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PwinNPY5bP"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"oToGwgnD6i"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook shows an advanced analysis case. The calculation was inspired by Angie Pendergrass’s work on precipitation statistics, as described in the following websites / papers:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XJrK4LnlpZ"}],"key":"pzlQ5TJVxM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"cite","url":"https://journals.ametsoc.org/doi/full/10.1175/JCLI-D-16-0684.1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Pendergrass & Deser (2017)","key":"iBmeY83fZH"}],"kind":"narrative","label":"Pendergrass_2017","identifier":"https://journals.ametsoc.org/doi/full/10.1175/JCLI-D-16-0684.1","enumerator":"1","key":"L2rmlodNGN"}],"key":"SIOeTfRGyK"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://climatedataguide.ucar.edu/climate-data/gpcp-daily-global-precipitation-climatology-project","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"https://​climatedataguide​.ucar​.edu​/climate​-data​/gpcp​-daily​-global​-precipitation​-climatology​-project","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ujHEQh4fRs"}],"urlSource":"https://climatedataguide.ucar.edu/climate-data/gpcp-daily-global-precipitation-climatology-project","key":"HZbPzum52x"}],"key":"AIsG9ekF9r"}],"key":"lX2zevvwha"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We use ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"muaOhIhg5T"},{"type":"link","url":"https://xhistogram.readthedocs.io/en/latest/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"xhistogram","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ob6kwtMM7b"}],"urlSource":"https://xhistogram.readthedocs.io/en/latest/","key":"TSncxgg9a4"},{"type":"text","value":" to calculate the distribution of precipitation intensity and its changes in a warming climate.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"tA1Xdqp6bI"}],"key":"MgMfHY9DZA"}],"key":"cXfPGCPL65"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RHmac9NckF"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"KskSOfHQDc"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yRmwxl3DmT"}],"key":"Z4ZKjMyiFb"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"du3Z7y8NkH"}],"key":"CqQaDXa5WO"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eAU3cF4dWF"}],"key":"rbefilegJk"}],"key":"KTiKS5Hx27"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Intro to Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yAz5UJyonY"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"cjVn8GW5zz"}],"key":"zWmTUL6Ji4"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BCEvBbIXRw"}],"key":"YpFU1EyN05"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[],"key":"jCb0z7URhX"}],"key":"YujWONzm5S"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Understanding of NetCDF","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"myFXdfkJ8f"}],"urlSource":"https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html","key":"qkhRrJtpV7"}],"key":"ROfjEZKCGv"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"dW2LBO5cWB"}],"key":"lJNHJpTg0V"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Familiarity with metadata structure","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"c0ti8VUYUw"}],"key":"CvVdnlbWHR"}],"key":"TnHfC7RzLF"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fYaWlu45MW"}],"key":"uCxvgpAtQI"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hRPKNAi7k2"}],"key":"SwvW34EmNk"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[],"key":"SLuWL3PFcY"}],"key":"ys2icqPyHh"}],"key":"gkbevCNC5f"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"KDbJxWR1EU"}],"key":"wW9xNZM2bm"},{"type":"text","value":": 5 minutes","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EFvbnztBE4"}],"key":"kVO6pXnh9L"}],"key":"wVaaBXMMDn"}],"key":"M9lFnmHPHJ"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P5uk69Qp33"}],"key":"jUTzGGqVGF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XwRHvwgKLM"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"fd2OidytrW"}],"key":"bGIOeEE0rU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport sys\nfrom matplotlib import pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport xarray as xr\nimport fsspec\nfrom tqdm.autonotebook import tqdm\nfrom xhistogram.xarray import histogram\nfrom dask_gateway import Gateway\nfrom dask.distributed import Client\n\n%matplotlib inline\nplt.rcParams['figure.figsize'] = 12, 6","key":"zeMVkq9JDx"},{"type":"output","id":"Num42MDR5ePk2iDh62fHR","data":[{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4201/106887996.py:8: TqdmExperimentalWarning: Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)\n  from tqdm.autonotebook import tqdm\n"}],"key":"LzXLBdvmOY"}],"key":"LeTCfh77Wy"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compute Cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vy5jlWjRcf"}],"identifier":"compute-cluster","label":"Compute Cluster","html_id":"compute-cluster","implicit":true,"key":"NBY4NIcmkC"}],"visibility":"show","key":"J3kP7Zs4mJ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we use a dask cluster to parallelize our analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UGzsLmytdi"}],"key":"LjeTo2ytgj"}],"key":"AY7FSKnfsc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"platform = sys.platform\n\nif (platform == 'win32'):\n    import multiprocessing.popen_spawn_win32\nelse:\n    import multiprocessing.popen_spawn_posix","key":"H3uZjqO3W0"},{"type":"output","id":"I_q2ELXHRYzOnB5IkfkYE","data":[],"key":"WPbthfQ99h"}],"key":"dQ6UFMMLYn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Initiate the Dask client:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fBaliUGnOQ"}],"key":"XCOJWvH3yM"}],"key":"xeDFVyxPok"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client = Client()\nclient","key":"BvkSfrfr26"},{"type":"output","id":"GSMs117IDNGD4QBFQNGLY","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/cmip6-cookbook-dev/lib/python3.11/site-packages/distributed/node.py:187: UserWarning: Port 8787 is already in use.\nPerhaps you already have a cluster running?\nHosting the HTTP server on port 38635 instead\n  warnings.warn(\n"},{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"<Client: 'tcp://127.0.0.1:40099' processes=4 threads=4, memory=15.62 GiB>","content_type":"text/plain"},"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-fdd84ea4-4cb0-11f0-9069-7ced8d57211e</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> distributed.LocalCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:38635/status\" target=\"_blank\">http://127.0.0.1:38635/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">b395a2aa</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:38635/status\" target=\"_blank\">http://127.0.0.1:38635/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 4\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 4\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-8bb08bcd-51ca-45a0-9122-854c5ce09d38</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:40099\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:38635/status\" target=\"_blank\">http://127.0.0.1:38635/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:40543\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:32845/status\" target=\"_blank\">http://127.0.0.1:32845/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:34577\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-widb_h00\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:41859\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:38073/status\" target=\"_blank\">http://127.0.0.1:38073/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:40697\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-h6vp3kaz\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:39579\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:42895/status\" target=\"_blank\">http://127.0.0.1:42895/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:36813\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-p86kib1x\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:34145\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:39157/status\" target=\"_blank\">http://127.0.0.1:39157/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:45509\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-73pokuhx\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"}}}],"key":"heiS85qqiQ"}],"key":"li3F2uCeLv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Data Catalog","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C7c7xI0Juq"}],"identifier":"load-data-catalog","label":"Load Data Catalog","html_id":"load-data-catalog","implicit":true,"key":"acHX6K3rUq"}],"key":"PTmo1RMXoa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df = pd.read_csv('https://storage.googleapis.com/cmip6/cmip6-zarr-consolidated-stores.csv')\ndf.head()","key":"WnFZzEEpMz"},{"type":"output","id":"aUUKLCtzsurvwC65Od8Vf","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"  activity_id institution_id     source_id       experiment_id member_id  \\\n0  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n1  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n2  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n3  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n4  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n\n  table_id variable_id grid_label  \\\n0     Amon          ps         gn   \n1     Amon        rsds         gn   \n2     Amon        rlus         gn   \n3     Amon        rlds         gn   \n4     Amon         psl         gn   \n\n                                              zstore  dcpp_init_year   version  \n0  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n1  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n2  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n3  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n4  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>activity_id</th>\n      <th>institution_id</th>\n      <th>source_id</th>\n      <th>experiment_id</th>\n      <th>member_id</th>\n      <th>table_id</th>\n      <th>variable_id</th>\n      <th>grid_label</th>\n      <th>zstore</th>\n      <th>dcpp_init_year</th>\n      <th>version</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>ps</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>rsds</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>rlus</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>rlds</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>psl</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"Q7MIGGsYAi"}],"key":"wQmMz8DgLH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_3hr_pr = df[(df.table_id == '3hr') & (df.variable_id == 'pr')]\nlen(df_3hr_pr)","key":"YNfGe8Y28K"},{"type":"output","id":"ViFQsOteZtixcEYB1Aftc","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"78","content_type":"text/plain"}}}],"key":"SAP0aLEQk7"}],"key":"WTfpPo26Dn"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"run_counts = df_3hr_pr.groupby(['source_id', 'experiment_id'])['zstore'].count()\nrun_counts","visibility":"show","key":"EZwUFA8Xjf"},{"type":"output","id":"azrjnKvajpQEf4EpnY7oz","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"source_id         experiment_id     \nBCC-CSM2-MR       historical             1\n                  ssp126                 1\n                  ssp245                 1\n                  ssp370                 1\n                  ssp585                 1\nCNRM-CM6-1        highresSST-present     1\n                  historical             3\n                  ssp126                 1\n                  ssp245                 1\n                  ssp370                 1\n                  ssp585                 1\nCNRM-CM6-1-HR     highresSST-present     1\nCNRM-ESM2-1       historical             1\n                  ssp126                 1\n                  ssp245                 1\n                  ssp370                 1\n                  ssp585                 1\nGFDL-CM4          1pctCO2                2\n                  abrupt-4xCO2           2\n                  amip                   2\n                  historical             2\n                  piControl              2\nGFDL-CM4C192      highresSST-future      1\n                  highresSST-present     1\nGFDL-ESM4         1pctCO2                1\n                  abrupt-4xCO2           1\n                  esm-hist               1\n                  historical             1\n                  ssp119                 1\n                  ssp126                 1\n                  ssp370                 1\nGISS-E2-1-G       historical             2\nHadGEM3-GC31-HM   highresSST-present     1\nHadGEM3-GC31-LM   highresSST-present     1\nHadGEM3-GC31-MM   highresSST-present     1\nIPSL-CM6A-ATM-HR  highresSST-present     1\nIPSL-CM6A-LR      highresSST-present     1\n                  historical            15\n                  piControl              1\n                  ssp126                 3\n                  ssp245                 2\n                  ssp370                10\n                  ssp585                 1\nMRI-ESM2-0        historical             1\nName: zstore, dtype: int64","content_type":"text/plain"}}}],"visibility":"show","key":"C2SoVnWBZn"}],"visibility":"show","key":"Kr8l3wpOk2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"source_ids = []\nexperiment_ids = ['historical', 'ssp585']\nfor name, group in df_3hr_pr.groupby('source_id'):\n    if all([expt in group.experiment_id.values\n            for expt in experiment_ids]):\n        source_ids.append(name)\nsource_ids\n\n# Use only one model. Otherwise it takes too long to run on GitHub.\nsource_ids = ['BCC-CSM2-MR']","key":"GWrW1n00HD"},{"type":"output","id":"ZQ6i9ixw-6NIjsYBH05qa","data":[],"key":"Cd1og8sBIL"}],"key":"rEGxG8ND67"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def load_pr_data(source_id, expt_id):\n    \"\"\"\n    Load 3hr precip data for given source and expt ids\n    \"\"\"\n    uri = df_3hr_pr[(df_3hr_pr.source_id == source_id) &\n                         (df_3hr_pr.experiment_id == expt_id)].zstore.values[0]\n\n    ds = xr.open_zarr(fsspec.get_mapper(uri), consolidated=True)\n    return ds","key":"C5zSAVxQll"},{"type":"output","id":"UFDpKOSYrGCdrv-kAkrsU","data":[],"key":"heZ6KwDC6v"}],"key":"TGEzG1Gxpd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def precip_hist(ds, nbins=100, pr_log_min=-3, pr_log_max=2):\n    \"\"\"\n    Calculate precipitation histogram for a single model.\n    Lazy.\n    \"\"\"\n    assert ds.pr.units == 'kg m-2 s-1'\n\n    # mm/day\n    bins_mm_day = np.hstack([[0], np.logspace(pr_log_min, pr_log_max, nbins)])\n    bins_kg_m2s = bins_mm_day / (24*60*60)\n\n    pr_hist = histogram(ds.pr, bins=[bins_kg_m2s], dim=['lon']).mean(dim='time')\n\n    log_bin_spacing = np.diff(np.log(bins_kg_m2s[1:3])).item()\n    pr_hist_norm = 100 * pr_hist / ds.dims['lon'] / log_bin_spacing\n    pr_hist_norm.attrs.update({'long_name': 'zonal mean rain frequency',\n                               'units': '%/Δln(r)'})\n    return pr_hist_norm\n\ndef precip_hist_for_expts(dsets, experiment_ids):\n    \"\"\"\n    Calculate histogram for a suite of experiments.\n    Eager.\n    \"\"\"\n    # actual data loading and computations happen in this next line\n    pr_hists = [precip_hist(ds).load()\n            for ds in [ds_hist, ds_ssp]]\n    pr_hist = xr.concat(pr_hists, dim=xr.Variable('experiment_id', experiment_ids))\n    return pr_hist","key":"ERH5TZ6FX1"},{"type":"output","id":"zDJYtmZN1_7ccUUTFC6Sl","data":[],"key":"NSUaMrhv5y"}],"key":"FnHko7DWJT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"results = {}\nfor source_id in tqdm(source_ids):\n    # get a 20 year period\n    ds_hist = load_pr_data(source_id, 'historical').sel(time=slice('1980', '2000'))\n    ds_ssp = load_pr_data(source_id, 'ssp585').sel(time=slice('2080', '2100'))\n    pr_hist = precip_hist_for_expts([ds_hist, ds_ssp], experiment_ids)\n    results[source_id] = pr_hist","key":"InScnEd4Qq"},{"type":"output","id":"5Gaat5PxWCAvbxzQo2SHP","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"  0%|          | 0/1 [00:00<?, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"9537b374853143118803c45b67e14d30\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4201/634789861.py:15: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.\n  pr_hist_norm = 100 * pr_hist / ds.dims['lon'] / log_bin_spacing\n"},{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4201/634789861.py:15: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.\n  pr_hist_norm = 100 * pr_hist / ds.dims['lon'] / log_bin_spacing\n"}],"key":"QWlIJiR1UV"}],"key":"yoxDBL0bXq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def plot_precip_changes(pr_hist, vmax=5):\n    \"\"\"\n    Visualize the output\n    \"\"\"\n    pr_hist_diff = (pr_hist.sel(experiment_id='ssp585') -\n                    pr_hist.sel(experiment_id='historical'))\n    pr_hist.sel(experiment_id='historical')[:, 1:].plot.contour(xscale='log', colors='0.5', levels=21)\n    pr_hist_diff[:, 1:].plot.contourf(xscale='log', vmax=vmax, levels=21)","key":"n6LvU4zqfY"},{"type":"output","id":"qWIG4mcLHZFB-0TvfQvZG","data":[],"key":"EkrPu45LWi"}],"key":"f47od3pvj4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"title = 'Change in Zonal Mean Rain Frequency'\nfor source_id, pr_hist in results.items():\n    plt.figure()\n    plot_precip_changes(pr_hist)\n    plt.title(f'{title}: {source_id}')","key":"ZtE5Nq4ug8"},{"type":"output","id":"RttkJwQQOpmUuxLD8MDzn","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x600 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"465606b3992408e7a06fa4fbbe5c7137","path":"/cmip6-cookbook/build/465606b3992408e7a06fa4fbbe5c7137.png"}}}],"key":"siFJWBQJ13"}],"key":"zbVfpyuYP7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We’re at the end of the notebook, so let’s shutdown our Dask cluster.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y7bumlkvjW"}],"key":"O7tpciQfiY"}],"key":"cKyP4Ht0gF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.shutdown()","key":"ti0ZfC8oqu"},{"type":"output","id":"pciZ_6KmoVENtjoduhsL9","data":[],"key":"JMLzRkmtW3"}],"key":"QXKSMcPu5c"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mHGElMcjR5"}],"visibility":"show","key":"a4p2v7AsDp"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n0vR3ZHAWS"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"h1GJve3NcA"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this notebook, we used CMIP6 data to compare precipitation intensity in the SSP585 scenario to historical runs.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Xx0Al1zKkM"}],"key":"eNeJNsYLKC"},{"type":"heading","depth":3,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What’s next?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WwGkcWlqof"}],"identifier":"whats-next","label":"What’s next?","html_id":"whats-next","implicit":true,"key":"rJTshD4nnZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"More examples of using CMIP6 data.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MbA55lYBdH"}],"key":"PuZOusiRZp"}],"key":"Z8I65i0JE7"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Resources and references","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"irraKpwPKx"}],"identifier":"resources-and-references","label":"Resources and references","html_id":"resources-and-references","implicit":true,"key":"ZlxHeFbCyf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"link","url":"http://gallery.pangeo.io/repos/pangeo-gallery/cmip6/precip_frequency_change.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Original notebook in the Pangeo Gallery","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TzESgZullT"}],"urlSource":"http://gallery.pangeo.io/repos/pangeo-gallery/cmip6/precip_frequency_change.html","key":"j9o79NRgET"},{"type":"text","value":" by Henri Drake and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"L2HHao2h9a"},{"type":"link","url":"https://ocean-transport.github.io/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Ryan Abernathey","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sziIMxgNqC"}],"urlSource":"https://ocean-transport.github.io/","key":"HBWRijXHT3"}],"key":"eGTnqeLS4e"}],"key":"lnH45hbyEe"}],"visibility":"show","key":"MsOT2oIAfZ"}],"key":"JcOMPUc5Xl"},"references":{"cite":{"order":["Pendergrass_2017"],"data":{"Pendergrass_2017":{"label":"Pendergrass_2017","enumerator":"1","doi":"10.1175/jcli-d-16-0684.1","html":"Pendergrass, A. G., & Deser, C. (2017). Climatological Characteristics of Typical Daily Precipitation. <i>Journal of Climate</i>, <i>30</i>(15), 5985–6003. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/jcli-d-16-0684.1\">10.1175/jcli-d-16-0684.1</a>","url":"https://doi.org/10.1175/jcli-d-16-0684.1"}}}},"footer":{"navigation":{"prev":{"title":"Global Mean Surface Temperature","url":"/notebooks/example-workflows/gmst","group":"Example workflows"},"next":{"title":"Regridding with xESMF and calculating a multi-model mean","url":"/notebooks/example-workflows/xesmf-ohu","group":"Example workflows"}}},"domain":"http://localhost:3000"}
{"version":2,"kind":"Notebook","sha256":"d2e2015d5b3da19b3e04c9be6b992347d561aee44bbdd0eda08783361835af4c","slug":"notebooks.example-workflows.precip-freq","location":"/notebooks/example-workflows/precip-freq.ipynb","dependencies":[],"frontmatter":{"title":"Precipitation Frequency Analysis","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Ryan Abernathey","given":"Ryan","family":"Abernathey"},"name":"Ryan Abernathey","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Henri Drake","given":"Henri","family":"Drake"},"name":"Henri Drake","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Robert Ford","given":"Robert","family":"Ford"},"name":"Robert Ford","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Max Grover","given":"Max","family":"Grover"},"name":"Max Grover","id":"contributors-myst-generated-uid-3"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/cmip6-cookbook","copyright":"2024","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/cmip6-cookbook/blob/main/notebooks/example-workflows/precip-freq.ipynb","exports":[{"format":"ipynb","filename":"precip-freq.ipynb","url":"/cmip6-cookbook/build/precip-freq-6c0adc7351e212efadd68216266ed3f2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ip3XHHrOlq"}],"key":"PM9UOUqCZK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wzcUd1QDd5"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"uPPycsgAiv"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook shows an advanced analysis case. The calculation was inspired by Angie Pendergrass’s work on precipitation statistics, as described in the following websites / papers:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SYL2mLkgwC"}],"key":"pUFvD0QIeB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"cite","url":"https://journals.ametsoc.org/doi/full/10.1175/JCLI-D-16-0684.1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Pendergrass & Deser (2017)","key":"Tj2Cg9OMI5"}],"kind":"narrative","label":"Pendergrass_2017","identifier":"https://journals.ametsoc.org/doi/full/10.1175/JCLI-D-16-0684.1","enumerator":"1","key":"EH9IiS4am2"}],"key":"hMv2JF3GLB"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://climatedataguide.ucar.edu/climate-data/gpcp-daily-global-precipitation-climatology-project","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"https://​climatedataguide​.ucar​.edu​/climate​-data​/gpcp​-daily​-global​-precipitation​-climatology​-project","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"B37oiz60iG"}],"urlSource":"https://climatedataguide.ucar.edu/climate-data/gpcp-daily-global-precipitation-climatology-project","key":"w1JsPvS4QA"}],"key":"um35CFjUbM"}],"key":"LurKux4LYz"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We use ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lziM5Ofh9f"},{"type":"link","url":"https://xhistogram.readthedocs.io/en/latest/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"xhistogram","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xA5IwMuphf"}],"urlSource":"https://xhistogram.readthedocs.io/en/latest/","key":"OnR2VlIsdZ"},{"type":"text","value":" to calculate the distribution of precipitation intensity and its changes in a warming climate.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"SriB4g9gqW"}],"key":"KCk45mYKg5"}],"key":"De0KEuj60C"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nt36Hshe8I"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"fGRtmHjgcH"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w0G1xdKwJt"}],"key":"HIESgJuqtQ"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UnLimeToO2"}],"key":"jjncw4HzSr"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H8SiorB1KG"}],"key":"OsD1wJLT37"}],"key":"u6PcyA5H6n"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Intro to Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xfD46sBd60"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"yUZXh0w1W9"}],"key":"uGr3pZqkzL"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EjTvEdQpue"}],"key":"KBpeeKUFgO"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[],"key":"CCZe1Ep9If"}],"key":"IcbmbAoEdS"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Understanding of NetCDF","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OSVID8WsZu"}],"urlSource":"https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html","key":"qa8nMwkrwJ"}],"key":"AZGRFDxrFD"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"NGSqDRrBpD"}],"key":"iHp3XjGsY8"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Familiarity with metadata structure","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"zrtD3ALqDX"}],"key":"W9AeEyM2M5"}],"key":"tzy5jVx22p"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yVyALVIL4C"}],"key":"bZvELV5aNE"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jeVvIPF5ED"}],"key":"pYdpsJX7oE"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[],"key":"TPY8utYKhk"}],"key":"bqCBaUGTrG"}],"key":"RXZvPBXQOJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TEIo7MyoFq"}],"key":"aFjSDbcQFn"},{"type":"text","value":": 5 minutes","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lmzw9gTGP2"}],"key":"ZDvBiJmv6l"}],"key":"IYto8sDilA"}],"key":"ee2gBPbHZ9"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dXBsmoIXHy"}],"key":"h1y25evdJq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jjXW6nbivQ"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"CPOnEGNL2S"}],"key":"rCkrjBIkNg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport sys\nfrom matplotlib import pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport xarray as xr\nimport fsspec\nfrom tqdm.autonotebook import tqdm\nfrom xhistogram.xarray import histogram\nfrom dask_gateway import Gateway\nfrom dask.distributed import Client\n\n%matplotlib inline\nplt.rcParams['figure.figsize'] = 12, 6","key":"ed1MmRH7jt"},{"type":"output","id":"E7EM3KMZPGK9QBTiAAu7K","data":[{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4267/106887996.py:8: TqdmExperimentalWarning: Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)\n  from tqdm.autonotebook import tqdm\n"}],"key":"tFzEL441Q7"}],"key":"hWTaMaUjha"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compute Cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mhvQXQhEdt"}],"identifier":"compute-cluster","label":"Compute Cluster","html_id":"compute-cluster","implicit":true,"key":"T1gobzLew1"}],"visibility":"show","key":"xnDGMqXtf9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we use a dask cluster to parallelize our analysis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z9s20DZDux"}],"key":"zNsrhhQ0cg"}],"key":"pCnpPYP9CZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"platform = sys.platform\n\nif (platform == 'win32'):\n    import multiprocessing.popen_spawn_win32\nelse:\n    import multiprocessing.popen_spawn_posix","key":"xij7HOSgTL"},{"type":"output","id":"aUZVe3tjlkCxOdwQ1a6TP","data":[],"key":"KVzd2tlUs0"}],"key":"DOLj0WIliW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Initiate the Dask client:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R9ARy6VZdt"}],"key":"DelFsmPzCT"}],"key":"v5gh8oT1Lo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client = Client()\nclient","key":"sCKK5XLl1N"},{"type":"output","id":"pKS2A3PXK-DM4k54rYT46","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/cmip6-cookbook-dev/lib/python3.11/site-packages/distributed/node.py:187: UserWarning: Port 8787 is already in use.\nPerhaps you already have a cluster running?\nHosting the HTTP server on port 46835 instead\n  warnings.warn(\n"},{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"<Client: 'tcp://127.0.0.1:44303' processes=4 threads=4, memory=15.62 GiB>","content_type":"text/plain"},"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-6c1d6e3c-52fa-11f0-90ab-6045bd86c3ab</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> distributed.LocalCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:46835/status\" target=\"_blank\">http://127.0.0.1:46835/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">9aba6b76</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:46835/status\" target=\"_blank\">http://127.0.0.1:46835/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 4\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 4\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-822800c8-f541-4640-81fa-5641781040bf</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:44303\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:46835/status\" target=\"_blank\">http://127.0.0.1:46835/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:38219\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:36363/status\" target=\"_blank\">http://127.0.0.1:36363/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:36137\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-gypusrl_\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:42221\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33249/status\" target=\"_blank\">http://127.0.0.1:33249/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:42181\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-rxpb02jn\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:46189\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:46831/status\" target=\"_blank\">http://127.0.0.1:46831/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:34819\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-mlmd0v3x\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:46615\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:39689/status\" target=\"_blank\">http://127.0.0.1:39689/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:44571\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-wzvu_w6j\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"}}}],"key":"ydZ7EDhjoe"}],"key":"hWRzAsejEd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Data Catalog","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ye0RwetB4g"}],"identifier":"load-data-catalog","label":"Load Data Catalog","html_id":"load-data-catalog","implicit":true,"key":"vgjA3ehJ8e"}],"key":"V5pI1hw5dq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df = pd.read_csv('https://storage.googleapis.com/cmip6/cmip6-zarr-consolidated-stores.csv')\ndf.head()","key":"VPOZaWKJsc"},{"type":"output","id":"1pizaYtffGChu6vD0yiPn","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"  activity_id institution_id     source_id       experiment_id member_id  \\\n0  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n1  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n2  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n3  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n4  HighResMIP           CMCC  CMCC-CM2-HR4  highresSST-present  r1i1p1f1   \n\n  table_id variable_id grid_label  \\\n0     Amon          ps         gn   \n1     Amon        rsds         gn   \n2     Amon        rlus         gn   \n3     Amon        rlds         gn   \n4     Amon         psl         gn   \n\n                                              zstore  dcpp_init_year   version  \n0  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n1  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n2  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n3  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  \n4  gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...             NaN  20170706  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>activity_id</th>\n      <th>institution_id</th>\n      <th>source_id</th>\n      <th>experiment_id</th>\n      <th>member_id</th>\n      <th>table_id</th>\n      <th>variable_id</th>\n      <th>grid_label</th>\n      <th>zstore</th>\n      <th>dcpp_init_year</th>\n      <th>version</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>ps</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>rsds</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>rlus</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>rlds</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>HighResMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-CM2-HR4</td>\n      <td>highresSST-present</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>psl</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/HighResMIP/CMCC/CMCC-CM2-HR4/...</td>\n      <td>NaN</td>\n      <td>20170706</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"h4CLwrUTAD"}],"key":"TuDFdv5y2e"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_3hr_pr = df[(df.table_id == '3hr') & (df.variable_id == 'pr')]\nlen(df_3hr_pr)","key":"Y0RvMgCPmj"},{"type":"output","id":"q-Mts3fjpHUdTrqqFiTJ7","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"78","content_type":"text/plain"}}}],"key":"k2lC98z3VL"}],"key":"KL7PouKwvT"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"run_counts = df_3hr_pr.groupby(['source_id', 'experiment_id'])['zstore'].count()\nrun_counts","visibility":"show","key":"G6GnwZDme6"},{"type":"output","id":"b5VI7OHte_DPjLFnxtleZ","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"source_id         experiment_id     \nBCC-CSM2-MR       historical             1\n                  ssp126                 1\n                  ssp245                 1\n                  ssp370                 1\n                  ssp585                 1\nCNRM-CM6-1        highresSST-present     1\n                  historical             3\n                  ssp126                 1\n                  ssp245                 1\n                  ssp370                 1\n                  ssp585                 1\nCNRM-CM6-1-HR     highresSST-present     1\nCNRM-ESM2-1       historical             1\n                  ssp126                 1\n                  ssp245                 1\n                  ssp370                 1\n                  ssp585                 1\nGFDL-CM4          1pctCO2                2\n                  abrupt-4xCO2           2\n                  amip                   2\n                  historical             2\n                  piControl              2\nGFDL-CM4C192      highresSST-future      1\n                  highresSST-present     1\nGFDL-ESM4         1pctCO2                1\n                  abrupt-4xCO2           1\n                  esm-hist               1\n                  historical             1\n                  ssp119                 1\n                  ssp126                 1\n                  ssp370                 1\nGISS-E2-1-G       historical             2\nHadGEM3-GC31-HM   highresSST-present     1\nHadGEM3-GC31-LM   highresSST-present     1\nHadGEM3-GC31-MM   highresSST-present     1\nIPSL-CM6A-ATM-HR  highresSST-present     1\nIPSL-CM6A-LR      highresSST-present     1\n                  historical            15\n                  piControl              1\n                  ssp126                 3\n                  ssp245                 2\n                  ssp370                10\n                  ssp585                 1\nMRI-ESM2-0        historical             1\nName: zstore, dtype: int64","content_type":"text/plain"}}}],"visibility":"show","key":"QRaecC6qVk"}],"visibility":"show","key":"qhgSP8IsDZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"source_ids = []\nexperiment_ids = ['historical', 'ssp585']\nfor name, group in df_3hr_pr.groupby('source_id'):\n    if all([expt in group.experiment_id.values\n            for expt in experiment_ids]):\n        source_ids.append(name)\nsource_ids\n\n# Use only one model. Otherwise it takes too long to run on GitHub.\nsource_ids = ['BCC-CSM2-MR']","key":"W2qIfhJYuq"},{"type":"output","id":"tHpu9hm3dbsy0a5nANzxI","data":[],"key":"Xo8CiKETUG"}],"key":"MqIesWRqwX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def load_pr_data(source_id, expt_id):\n    \"\"\"\n    Load 3hr precip data for given source and expt ids\n    \"\"\"\n    uri = df_3hr_pr[(df_3hr_pr.source_id == source_id) &\n                         (df_3hr_pr.experiment_id == expt_id)].zstore.values[0]\n\n    ds = xr.open_zarr(fsspec.get_mapper(uri), consolidated=True)\n    return ds","key":"PR5QbdImFv"},{"type":"output","id":"78AlPRxQXPu4l9gYcXiIv","data":[],"key":"f7WQsTWB1Z"}],"key":"x2zrBaUo67"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def precip_hist(ds, nbins=100, pr_log_min=-3, pr_log_max=2):\n    \"\"\"\n    Calculate precipitation histogram for a single model.\n    Lazy.\n    \"\"\"\n    assert ds.pr.units == 'kg m-2 s-1'\n\n    # mm/day\n    bins_mm_day = np.hstack([[0], np.logspace(pr_log_min, pr_log_max, nbins)])\n    bins_kg_m2s = bins_mm_day / (24*60*60)\n\n    pr_hist = histogram(ds.pr, bins=[bins_kg_m2s], dim=['lon']).mean(dim='time')\n\n    log_bin_spacing = np.diff(np.log(bins_kg_m2s[1:3])).item()\n    pr_hist_norm = 100 * pr_hist / ds.dims['lon'] / log_bin_spacing\n    pr_hist_norm.attrs.update({'long_name': 'zonal mean rain frequency',\n                               'units': '%/Δln(r)'})\n    return pr_hist_norm\n\ndef precip_hist_for_expts(dsets, experiment_ids):\n    \"\"\"\n    Calculate histogram for a suite of experiments.\n    Eager.\n    \"\"\"\n    # actual data loading and computations happen in this next line\n    pr_hists = [precip_hist(ds).load()\n            for ds in [ds_hist, ds_ssp]]\n    pr_hist = xr.concat(pr_hists, dim=xr.Variable('experiment_id', experiment_ids))\n    return pr_hist","key":"rYxDgtZKb6"},{"type":"output","id":"qOoSNp0g0FVrBTJLuwsyO","data":[],"key":"s99dsn01Mw"}],"key":"HFPHiXtwTO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"results = {}\nfor source_id in tqdm(source_ids):\n    # get a 20 year period\n    ds_hist = load_pr_data(source_id, 'historical').sel(time=slice('1980', '2000'))\n    ds_ssp = load_pr_data(source_id, 'ssp585').sel(time=slice('2080', '2100'))\n    pr_hist = precip_hist_for_expts([ds_hist, ds_ssp], experiment_ids)\n    results[source_id] = pr_hist","key":"b9dvQlpkeV"},{"type":"output","id":"kJHSIdlO4K20vA9ecJ8vH","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"  0%|          | 0/1 [00:00<?, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"378fe3fab77c4d668a37764b141e3095\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4267/634789861.py:15: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.\n  pr_hist_norm = 100 * pr_hist / ds.dims['lon'] / log_bin_spacing\n"},{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4267/634789861.py:15: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.\n  pr_hist_norm = 100 * pr_hist / ds.dims['lon'] / log_bin_spacing\n"}],"key":"xss8PBZdR4"}],"key":"T7SBS56bpE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def plot_precip_changes(pr_hist, vmax=5):\n    \"\"\"\n    Visualize the output\n    \"\"\"\n    pr_hist_diff = (pr_hist.sel(experiment_id='ssp585') -\n                    pr_hist.sel(experiment_id='historical'))\n    pr_hist.sel(experiment_id='historical')[:, 1:].plot.contour(xscale='log', colors='0.5', levels=21)\n    pr_hist_diff[:, 1:].plot.contourf(xscale='log', vmax=vmax, levels=21)","key":"EZE457rSX1"},{"type":"output","id":"79AcCmMj8zUSxXbfI-HEq","data":[],"key":"lgT66VoA54"}],"key":"IFxCNhod30"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"title = 'Change in Zonal Mean Rain Frequency'\nfor source_id, pr_hist in results.items():\n    plt.figure()\n    plot_precip_changes(pr_hist)\n    plt.title(f'{title}: {source_id}')","key":"Fbc5kIGRZO"},{"type":"output","id":"a1GA4p5nditcPH0BXJQzR","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x600 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"465606b3992408e7a06fa4fbbe5c7137","path":"/cmip6-cookbook/build/465606b3992408e7a06fa4fbbe5c7137.png"}}}],"key":"IKidQUZwQV"}],"key":"O8CJNhL7bn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We’re at the end of the notebook, so let’s shutdown our Dask cluster.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BVFj1o0v0l"}],"key":"z87Kdz925u"}],"key":"TB70d8gEaa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.shutdown()","key":"uYajE7XGej"},{"type":"output","id":"1Tft3bekGPi845P4QfV1o","data":[],"key":"mNvR0VJS2u"}],"key":"S8Ge7bzz50"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m3jn9cog4C"}],"visibility":"show","key":"W5XYrJBIXh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KHawWyrClM"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"NsYVo7zTNn"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this notebook, we used CMIP6 data to compare precipitation intensity in the SSP585 scenario to historical runs.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"p7HSHOCOhp"}],"key":"pHJQyt4LZr"},{"type":"heading","depth":3,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What’s next?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BBH8r2thTE"}],"identifier":"whats-next","label":"What’s next?","html_id":"whats-next","implicit":true,"key":"T9i3FYWwpK"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"More examples of using CMIP6 data.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"P04WwwBK4E"}],"key":"rloVOwynbZ"}],"key":"apexqwc2Qi"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Resources and references","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"abmDeqjJY8"}],"identifier":"resources-and-references","label":"Resources and references","html_id":"resources-and-references","implicit":true,"key":"vbeGvLp7sq"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"link","url":"http://gallery.pangeo.io/repos/pangeo-gallery/cmip6/precip_frequency_change.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Original notebook in the Pangeo Gallery","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ebn7UwidH6"}],"urlSource":"http://gallery.pangeo.io/repos/pangeo-gallery/cmip6/precip_frequency_change.html","key":"SFNR6aUBi3"},{"type":"text","value":" by Henri Drake and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Y1CQDBUZwJ"},{"type":"link","url":"https://ocean-transport.github.io/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Ryan Abernathey","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qt78DzEmYp"}],"urlSource":"https://ocean-transport.github.io/","key":"cJL2pBekWr"}],"key":"cVMtXFLR5c"}],"key":"GKhGvRlQxi"}],"visibility":"show","key":"LGYyou5Ryt"}],"key":"eQD6gyntAI"},"references":{"cite":{"order":["Pendergrass_2017"],"data":{"Pendergrass_2017":{"label":"Pendergrass_2017","enumerator":"1","doi":"10.1175/jcli-d-16-0684.1","html":"Pendergrass, A. G., & Deser, C. (2017). Climatological Characteristics of Typical Daily Precipitation. <i>Journal of Climate</i>, <i>30</i>(15), 5985–6003. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/jcli-d-16-0684.1\">10.1175/jcli-d-16-0684.1</a>","url":"https://doi.org/10.1175/jcli-d-16-0684.1"}}}},"footer":{"navigation":{"prev":{"title":"Global Mean Surface Temperature","url":"/notebooks/example-workflows/gmst","group":"Example workflows"},"next":{"title":"Regridding with xESMF and calculating a multi-model mean","url":"/notebooks/example-workflows/xesmf-ohu","group":"Example workflows"}}},"domain":"http://localhost:3000"}